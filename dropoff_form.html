<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafetyFixs - Drop Off Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-container {
            transition: background-color 0.5s ease;
        }
        .quantity-spinner {
            /* Styles for the quantity spinners for parts */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 py-3 flex justify-between items-center">
            <a href="./safetyfixs_main_page.html">
                <img src="https://images.squarespace-cdn.com/content/v1/6642e66aeaeff72f1adc408c/0fe8f795-06e1-40c2-9771-2b4c502873e9/logo+.png?format=1500w" alt="SafetyFixs Logo" class="h-12 md:h-16">
            </a>
            <div class="hidden md:flex space-x-4 lg:space-x-6 items-center">
                <a href="./safetyfixs_main_page.html#home" class="text-gray-600 hover:text-amber-600 transition duration-300">Home</a>
                <a href="./safetyfixs_main_page.html#about" class="text-gray-600 hover:text-amber-600 transition duration-300">About Us</a>
                <a href="./safetyfixs_main_page.html#services" class="text-gray-600 hover:text-amber-600 transition duration-300">Services</a>
                <a href="./safetyfixs_main_page.html#contact" class="text-gray-600 hover:text-amber-600 transition duration-300">Contact</a>
                <a href="./dropoff_form.html" class="bg-amber-500 text-white px-4 py-2 rounded-md hover:bg-amber-600 transition duration-300 whitespace-nowrap">Drop Off Form</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden flex items-center">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden">
            <a href="./safetyfixs_main_page.html#home" class="block py-2 px-4 text-sm hover:bg-gray-200">Home</a>
            <a href="./safetyfixs_main_page.html#about" class="block py-2 px-4 text-sm hover:bg-gray-200">About Us</a>
            <a href="./safetyfixs_main_page.html#services" class="block py-2 px-4 text-sm hover:bg-gray-200">Services</a>
            <a href="./safetyfixs_main_page.html#contact" class="block py-2 px-4 text-sm hover:bg-gray-200">Contact</a>
            <a href="./dropoff_form.html" class="block py-2 px-4 text-sm bg-amber-500 text-white">Drop Off Form</a>
        </div>
    </header>

    <main>
        <section id="dropoff" class="py-12 md:py-20 bg-gray-900">
            <div class="container mx-auto px-4 sm:px-6">
                <div class="bg-gray-800 p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-4xl mx-auto border border-gray-700 form-container">
                    <h2 class="text-3xl font-bold text-center mb-4 text-white">Safety Fix Form</h2>
                    <p id="form-status-message" class="text-center text-green-400 mb-8 hidden"></p>
                    <form id="dropOffForm" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="relative">
                                <label for="customerName" class="block text-sm font-medium text-gray-300 mb-1">Shop Name</label>
                                <input type="text" id="customerName" name="customerName" class="mt-1 block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm bg-gray-700 text-gray-200" required autocomplete="off" />
                                <ul id="customerNameSuggestions" class="absolute z-20 w-full bg-gray-700 border border-gray-600 rounded-md mt-1 max-h-48 overflow-y-auto shadow-lg hidden"></ul>
                            </div>
                             <div>
                                <label for="phoneNumber" class="block text-sm font-medium text-gray-300 mb-1">Phone #</label>
                                <input type="tel" id="phoneNumber" name="phoneNumber" class="mt-1 block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm bg-gray-700 text-gray-200" required placeholder="e.g., 801-123-4567" maxlength="12" />
                                <p id="phoneNumberError" class="mt-1 text-sm text-red-400 hidden"></p>
                            </div>
                        </div>
                        
                        <div>
                            <label for="dropOffType" class="block text-sm font-medium text-gray-300 mb-1">What will you drop off?</label>
                            <select id="dropOffType" name="dropOffType" class="mt-1 block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm bg-gray-700 text-gray-200" required>
                                <option value="">Select an option</option>
                                <option value="vehicle">Vehicle</option>
                                <option value="part">Part</option>
                            </select>
                        </div>

                        <div id="vehicleDetails" class="space-y-6 p-4 bg-gray-700 rounded-md border border-gray-600 hidden">
                            <h3 class="text-lg font-semibold text-gray-200">Vehicle Details</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                                <div>
                                    <label for="vehicleYear" class="block text-sm font-medium text-gray-300 mb-1">Year</label>
                                    <select id="vehicleYear" name="vehicleYear" class="mt-1 block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm bg-gray-700 text-gray-200"></select>
                                </div>
                                <div>
                                    <label for="vehicleMake" class="block text-sm font-medium text-gray-300 mb-1">Make</label>
                                    <select id="vehicleMake" name="vehicleMake" class="mt-1 block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm bg-gray-700 text-gray-200"></select>
                                </div>
                                <div>
                                    <label for="vehicleModel" class="block text-sm font-medium text-gray-300 mb-1">Model</label>
                                    <select id="vehicleModel" name="vehicleModel" class="mt-1 block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm bg-gray-700 text-gray-200" disabled></select>
                                </div>
                            </div>
                            <div class="sm:col-span-2 md:col-span-3">
                                <label for="additionalNotes" class="block text-sm font-medium text-gray-300 mb-1">Service Type</label>
                                <select id="additionalNotes" name="additionalNotes" class="mt-1 block w-full px-3 py-2 border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm bg-gray-700 text-gray-200">
                                    <option value="repair">Repair</option>
                                    <option value="diagnostic">Diagnostic</option>
                                </select>
                            </div>
                        </div>

                        <div id="partDetails" class="space-y-6 p-4 bg-gray-700/50 rounded-lg border border-gray-600 hidden">
                            <h3 class="text-lg font-semibold text-gray-200 text-center">Part Details (Quantities)</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div class="part-card flex flex-col items-center space-y-3 p-3 bg-gray-700 rounded-lg border border-gray-600 transition-colors duration-200">
                                    <div class="h-24 w-full flex items-center justify-center bg-gray-800 rounded-md overflow-hidden">
                                        <img class="h-full w-full object-contain" loading="lazy" src="./img/modules.webp" onerror="this.onerror=null; this.src='https://placehold.co/150x100/6B7280/FFFFFF?text=Module';">
                                    </div>
                                    <label class="block text-sm font-medium text-gray-300">Module(s)</label>
                                    <div id="moduleSpinner" class="quantity-spinner" data-value="0" data-min="0" data-max="20"></div>
                                </div>
                                <div class="part-card flex flex-col items-center space-y-3 p-3 bg-gray-700 rounded-lg border border-gray-600 transition-colors duration-200">
                                    <div class="h-24 w-full flex items-center justify-center bg-gray-800 rounded-md overflow-hidden">
                                        <img class="h-full w-full object-contain" loading="lazy" src="./img/Single Stage(s) .webp" onerror="this.onerror=null; this.src='https://placehold.co/150x100/6B7280/FFFFFF?text=Single+Stage';">
                                    </div>
                                    <label class="block text-sm font-medium text-gray-300">Single Stage</label>
                                    <div id="singleStageSpinner" class="quantity-spinner" data-value="0" data-min="0" data-max="20"></div>
                                </div>
                                <div class="part-card flex flex-col items-center space-y-3 p-3 bg-gray-700 rounded-lg border border-gray-600 transition-colors duration-200">
                                    <div class="h-24 w-full flex items-center justify-center bg-gray-800 rounded-md overflow-hidden">
                                        <img class="h-full w-full object-contain" loading="lazy" src="./img/Dual Stage(s) .webp" onerror="this.onerror=null; this.src='https://placehold.co/150x100/6B7280/FFFFFF?text=Dual+Stage';">
                                    </div>
                                    <label class="block text-sm font-medium text-gray-300">Dual Stage</label>
                                    <div id="dualStageSpinner" class="quantity-spinner" data-value="0" data-min="0" data-max="20"></div>
                                </div>
                                <div class="part-card flex flex-col items-center space-y-3 p-3 bg-gray-700 rounded-lg border border-gray-600 transition-colors duration-200">
                                    <div class="h-24 w-full flex items-center justify-center bg-gray-800 rounded-md overflow-hidden">
                                        <img class="h-full w-full object-contain" loading="lazy" src="./img/3 Stage(s).jpg" onerror="this.onerror=null; this.src='https://placehold.co/150x100/6B7280/FFFFFF?text=Triple+Stage';">
                                    </div>
                                    <label class="block text-sm font-medium text-gray-300">Triple Stage</label>
                                    <div id="threeStageSpinner" class="quantity-spinner" data-value="0" data-min="0" data-max="20"></div>
                                </div>
                                <div class="part-card flex flex-col items-center space-y-3 p-3 bg-gray-700 rounded-lg border border-gray-600 transition-colors duration-200">
                                    <div class="h-24 w-full flex items-center justify-center bg-gray-800 rounded-md overflow-hidden">
                                        <img class="h-full w-full object-contain" loading="lazy" src="https://placehold.co/150x100/6B7280/FFFFFF?text=Buckle" alt="Seatbelt Buckle">
                                    </div>
                                    <label class="block text-sm font-medium text-gray-300">Buckles</label>
                                    <div id="buckleSpinner" class="quantity-spinner" data-value="0" data-min="0" data-max="20"></div>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4 rounded-lg bg-gray-900/50 p-4 border border-gray-600">
                             <div class="flex items-start">
                                <div class="flex items-center h-5">
                                    <input id="smsOptIn" name="smsOptIn" type="checkbox" class="focus:ring-orange-500 h-4 w-4 text-orange-600 border-gray-500 rounded bg-gray-700" required>
                                </div>
                                <div class="ml-3 text-sm">
                                    <label for="smsOptIn" class="font-medium text-gray-300">I agree to receive text messages about my service order.</label>
                                </div>
                            </div>
                            <p class="text-xs text-gray-400">
                                By checking this box, you consent to receive automated text messages from SafetyFixs regarding your service status at the number provided. Message frequency varies. **Message and data rates may apply.** Reply **HELP** for help or **STOP** to cancel. Your mobile information will not be shared with third parties for marketing purposes.
                            </p>
                        </div>

                        <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-500 hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition duration-150 ease-in-out">Submit</button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-900 text-white py-6">
        <div class="container mx-auto px-4 sm:px-6 text-center">
            <div class="flex justify-center mb-4">
                <a href="https://www.instagram.com/safetyfixmodule/" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12.315 2c-4.04.004-4.503.018-6.08.087C4.601 2.157 3.63 2.383 2.913 3.1c-.717.717-.943 1.688-1.012 3.218C1.833 7.897 1.82 8.356 1.818 12.315c-.003 4.04.01 4.504.079 6.08.07 1.53.295 2.5.988 3.193.717.717 1.688.943 3.218 1.012 1.578.068 2.04.082 6.08.078 4.04-.004 4.503-.018 6.08-.087 1.53-.07 2.5-.295 3.193-.988.717-.717.943-1.688 1.012-3.218.068-1.577.082-2.04.078-6.08-.004-4.04-.018-4.503-.087-6.08-.07-1.53-.295-2.5-.988-3.193-.717-.717-1.688-.943-3.218-1.012C16.818 2.018 16.36 2.004 12.315 2zm0 1.802c3.96 0 4.38.015 5.91.082.996.045 1.504.248 1.857.594.4.4.602.91.648 1.857.067 1.53.08 1.95.08 5.91s-.013 4.38-.08 5.91c-.046.948-.248 1.456-.648 1.857-.4.4-.91.602-1.857.648-1.53.067-1.95.08-5.91.08s-4.38-.013-5.91-.08c-.948-.046-1.456-.248-1.857-.648-.4-.4-.602-.91-.648-1.857-.067-1.53-.08-1.95-.08-5.91s.013-4.38.08-5.91c.046-.948.248 1.456.648-1.857.353-.346.86-.55 1.857-.594C7.935 3.817 8.355 3.802 12.315 3.802zM12 7.38a4.62 4.62 0 100 9.24 4.62 4.62 0 000-9.24zm0 7.438a2.818 2.818 0 110-5.636 2.818 2.818 0 010 5.636zm6.405-7.84a1.08 1.08 0 100-2.16 1.08 1.08 0 000 2.16z" clip-rule="evenodd" />
                    </svg>
                </a>
            </div>
            <div class="space-x-4">
                 <p class="inline">&copy; 2025 SafetyFixs. All Rights Reserved.</p>
                 <a href="./privacy.html" class="text-gray-400 hover:text-white transition-colors duration-300">Privacy Policy</a>
            </div>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Mobile Menu ---
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // --- Form Script ---
        const API_BASE_URL = 'https://safetyfixs.com';
        let allClients = [];
        const mockVehicles = { models: { 'Acura': ['ILX', 'Integra', 'MDX', 'NSX', 'RDX', 'TLX'], 'Alfa Romeo': ['Giulia', 'Stelvio', 'Tonale'], 'Audi': ['A3', 'A4', 'A5', 'A6', 'A7', 'A8', 'e-tron', 'e-tron GT', 'Q3', 'Q4 e-tron', 'Q5', 'Q7', 'Q8', 'R8', 'TT'], 'Bentley': ['Bentayga', 'Continental GT', 'Flying Spur'], 'BMW': ['2 Series', '3 Series', '4 Series', '5 Series', '7 Series', '8 Series', 'i3', 'i4', 'i7', 'iX', 'X1', 'X2', 'X3', 'X4', 'X5', 'X6', 'X7', 'Z4'], 'Bugatti': ['Chiron', 'Divo', 'Veyron'], 'Buick': ['Enclave', 'Encore', 'Encore GX', 'Envista', 'Envision', 'LaCrosse', 'Regal'], 'Cadillac': ['CT4', 'CT5', 'CT6', 'Escalade', 'Escalade ESV', 'Lyriq', 'XT4', 'XT5', 'XT6'], 'Chevrolet': ['Blazer', 'Bolt EUV', 'Bolt EV', 'Camaro', 'Colorado', 'Corvette', 'Cruze', 'Equinox', 'Express', 'Impala', 'Malibu', 'Silverado 1500', 'Silverado 2500HD', 'Silverado 3500HD', 'Sonic', 'Suburban', 'Tahoe', 'Trailblazer', 'Traverse', 'Trax'], 'Chrysler': ['300', 'Pacifica', 'Voyager'], 'Dodge': ['Challenger', 'Charger', 'Durango', 'Grand Caravan', 'Hornet', 'Journey'], 'Ferrari': ['296', '812', 'F8', 'Portofino M', 'Purosangue', 'Roma', 'SF90'], 'Fiat': ['124 Spider', '500', '500L', '500X'], 'Fisker': ['Ocean'], 'Ford': ['Bronco', 'Bronco Sport', 'E-Transit', 'EcoSport', 'Edge', 'Escape', 'Expedition', 'Explorer', 'F-150', 'F-250', 'F-350', 'F-450', 'Fiesta', 'Focus', 'Fusion', 'Maverick', 'Mustang', 'Mustang Mach-E', 'Ranger', 'Transit', 'Transit Connect'], 'GMC': ['Acadia', 'Canyon', 'Hummer EV', 'Savana', 'Sierra 1500', 'Sierra 2500HD', 'Sierra 3500HD', 'Terrain', 'Yukon', 'Yukon XL'], 'Genesis': ['G70', 'G80', 'G90', 'GV60', 'GV70', 'GV80'], 'Honda': ['Accord', 'Civic', 'CR-V', 'Fit', 'HR-V', 'Insight', 'Odyssey', 'Passport', 'Pilot', 'Prologue', 'Ridgeline'], 'Hyundai': ['Accent', 'Elantra', 'Ioniq 5', 'Ioniq 6', 'Kona', 'Nexo', 'Palisade', 'Santa Cruz', 'Santa Fe', 'Sonata', 'Tucson', 'Veloster', 'Venue'], 'Infiniti': ['Q50', 'Q60', 'QX50', 'QX55', 'QX60', 'QX80'], 'Jaguar': ['E-Pace', 'F-Pace', 'F-Type', 'I-Pace', 'XE', 'XF', 'XJ'], 'Jeep': ['Cherokee', 'Compass', 'Gladiator', 'Grand Cherokee', 'Grand Cherokee L', 'Grand Wagoneer', 'Renegade', 'Wagoneer', 'Wrangler'], 'Kia': ['Carnival', 'EV6', 'EV9', 'Forte', 'K5', 'K900', 'Niro', 'Optima', 'Rio', 'Seltos', 'Sorento', 'Soul', 'Sportage', 'Stinger', 'Telluride'], 'Lamborghini': ['Aventador', 'Countach', 'Huracan', 'Revuelto', 'Urus'], 'Land Rover': ['Defender', 'Discovery', 'Discovery Sport', 'Range Rover', 'Range Rover Evoque', 'Range Rover Sport', 'Range Rover Velar'], 'Lexus': ['ES', 'GS', 'GX', 'IS', 'LC', 'LS', 'LX', 'NX', 'RC', 'RX', 'RZ', 'TX', 'UX'], 'Lincoln': ['Aviator', 'Continental', 'Corsair', 'MKZ', 'Nautilus', 'Navigator'], 'Lucid': ['Air', 'Gravity'], 'Maserati': ['Ghibli', 'GranTurismo', 'Grecale', 'Levante', 'MC20', 'Quattroporte'], 'Mazda': ['CX-30', 'CX-5', 'CX-50', 'CX-9', 'CX-90', 'Mazda3', 'Mazda6', 'MX-30', 'MX-5 Miata'], 'McLaren': ['720S', '750S', 'Artura', 'GT'], 'Mercedes-Benz': ['A-Class', 'AMG GT', 'C-Class', 'CLA', 'CLE', 'CLS', 'E-Class', 'EQB', 'EQE', 'EQS', 'GLA', 'GLB', 'GLC', 'GLE', 'GLS', 'Metris', 'S-Class', 'SL', 'Sprinter'], 'Mini': ['Clubman', 'Convertible', 'Countryman', 'Hardtop'], 'Mitsubishi': ['Eclipse Cross', 'Mirage', 'Outlander', 'Outlander Sport'], 'Nissan': ['Altima', 'Armada', 'Ariya', 'Frontier', 'GT-R', 'Kicks', 'Leaf', 'Maxima', 'Murano', 'NV200', 'Pathfinder', 'Rogue', 'Sentra', 'Titan', 'Versa', 'Z'], 'Polestar': ['Polestar 1', 'Polestar 2', 'Polestar 3'], 'Porsche': ['718 Boxster', '718 Cayman', '911', 'Cayenne', 'Macan', 'Panamera', 'Taycan'], 'Ram': ['1500', '2500', '3500', 'ProMaster', 'ProMaster City'], 'Rivian': ['R1S', 'R1T'], 'Rolls-Royce': ['Cullinan', 'Ghost', 'Phantom', 'Spectre'], 'Subaru': ['Ascent', 'BRZ', 'Crosstrek', 'Forester', 'Impreza', 'Legacy', 'Outback', 'Solterra', 'WRX'], 'Tesla': ['Cybertruck', 'Model 3', 'Model S', 'Model X', 'Model Y', 'Roadster'], 'Toyota': ['4Runner', '86', 'Avalon', 'bZ4X', 'Camry', 'C-HR', 'Corolla', 'Corolla Cross', 'Crown', 'Grand Highlander', 'Highlander', 'Land Cruiser', 'Prius', 'RAV4', 'Sequoia', 'Sienna', 'Supra', 'Tacoma', 'Tundra', 'Venza', 'Yaris'], 'Volkswagen': ['Arteon', 'Atlas', 'Golf GTI', 'Golf R', 'ID.4', 'Jetta', 'Passat', 'Taos', 'Tiguan'], 'Volvo': ['C40', 'EX30', 'EX90', 'S60', 'S90', 'V60', 'V90', 'XC40', 'XC60', 'XC90'] } };
        
        const dropOffForm = document.getElementById('dropOffForm');
        if (!dropOffForm) return;

        const customerNameInput = document.getElementById('customerName');
        const customerSuggestionsList = document.getElementById('customerNameSuggestions');
        const phoneNumberInput = document.getElementById('phoneNumber');
        const phoneNumberError = document.getElementById('phoneNumberError');
        const dropOffTypeSelect = document.getElementById('dropOffType');
        const vehicleDetailsDiv = document.getElementById('vehicleDetails');
        const partDetailsDiv = document.getElementById('partDetails');
        const vehicleYearSelect = document.getElementById('vehicleYear');
        const vehicleMakeSelect = document.getElementById('vehicleMake');
        const vehicleModelSelect = document.getElementById('vehicleModel');

        async function fetchClients() { try { const r = await fetch(`${API_BASE_URL}/api/clients`); if (!r.ok) throw new Error('Could not fetch client data.'); allClients = await r.json(); } catch (e) { console.error('Error fetching client data:', e); allClients = []; } }

        function formatPhoneNumber(v) { if (!v) return v; let p = v.replace(/\D/g, ''); if (p.length > 10) p = p.slice(0, 10); const l = p.length; if (l < 4) return p; if (l < 7) return `${p.slice(0,3)}-${p.slice(3)}`; return `${p.slice(0,3)}-${p.slice(3,6)}-${p.slice(6,10)}`; }
        function validatePhoneNumber(n) { const c = n.replace(/\D/g, ''); if (c.length > 0 && c.length !== 10) return 'Phone number must be 10 digits.'; return ''; }
        function showNotification(m, isError = false) { const c = dropOffForm.parentElement, s = document.getElementById('form-status-message'); if (!c || !s) return; c.classList.remove('bg-green-900','bg-red-900'); s.classList.remove('text-green-400','text-red-400'); if (isError) { c.classList.add('bg-red-900'); s.classList.add('text-red-400'); } else { c.classList.add('bg-green-900'); s.classList.add('text-green-400'); } s.textContent = m; s.classList.remove('hidden'); setTimeout(() => { c.classList.remove('bg-green-900','bg-red-900'); s.classList.add('hidden'); }, 4000); }
        function createSpinner(c) { const v = c.dataset.value; c.innerHTML = `<div class="flex items-center justify-center w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm text-gray-200"><button type="button" data-action="decrement" class="px-3 py-2 text-lg font-bold text-gray-400 hover:text-white hover:bg-gray-600 rounded-l-md transition-colors">-</button><span class="flex-grow text-center text-lg font-semibold select-none">${v}</span><button type="button" data-action="increment" class="px-3 py-2 text-lg font-bold text-gray-400 hover:text-white hover:bg-gray-600 rounded-r-md transition-colors">+</button></div>`; }
        function handleSpinnerClick(e) { const b = e.target.closest('button'); if (!b) return; const s = e.currentTarget, a = b.dataset.action; let v = parseInt(s.dataset.value, 10); const min = parseInt(s.dataset.min, 10), max = parseInt(s.dataset.max, 10); if (a === 'increment') v = Math.min(max, v + 1); else if (a === 'decrement') v = Math.max(min, v - 1); s.dataset.value = v; s.querySelector('span').textContent = v; const card = s.closest('.part-card'); if (card) { card.classList.add('bg-amber-600'); setTimeout(() => card.classList.remove('bg-amber-600'), 200); } if (navigator.vibrate) navigator.vibrate(50); }
        function renderSuggestions(ul, suggestions, onClick, displayKey = '') { ul.innerHTML = ''; if (suggestions.length === 0) { ul.classList.add('hidden'); return; } suggestions.forEach(item => { const li = document.createElement('li'); li.className = 'px-3 py-2 cursor-pointer text-gray-200 hover:bg-gray-600 rounded-md'; li.textContent = displayKey ? item[displayKey] : item; li.addEventListener('mousedown', (e) => { e.preventDefault(); onClick(item); }); ul.appendChild(li); }); ul.classList.remove('hidden'); }
        function updateConditionalFields() { const t = dropOffTypeSelect.value; vehicleDetailsDiv.classList.toggle('hidden', t !== 'vehicle'); partDetailsDiv.classList.toggle('hidden', t !== 'part'); }

        function populateYears() { const currentYear = new Date().getFullYear() + 2; vehicleYearSelect.innerHTML = '<option value="">Select Year</option>'; for (let year = currentYear; year >= 1991; year--) { const option = document.createElement('option'); option.value = year; option.textContent = year; vehicleYearSelect.appendChild(option); } }
        function populateMakes() { vehicleMakeSelect.innerHTML = '<option value="">Select Make</option>'; Object.keys(mockVehicles.models).sort().forEach(make => { const option = document.createElement('option'); option.value = make; option.textContent = make; vehicleMakeSelect.appendChild(option); }); }
        function populateModels(make) { vehicleModelSelect.innerHTML = '<option value="">Select Model</option>'; vehicleModelSelect.disabled = true; if (make && mockVehicles.models[make]) { mockVehicles.models[make].sort().forEach(model => { const option = document.createElement('option'); option.value = model; option.textContent = model; vehicleModelSelect.appendChild(option); }); vehicleModelSelect.disabled = false; } }

        function handleInputChange(e) { const { name, value } = e.target; if (name === 'phoneNumber') { const f = formatPhoneNumber(value); e.target.value = f; const err = validatePhoneNumber(value); phoneNumberError.textContent = err; phoneNumberError.classList.toggle('hidden', !err); } else if (name === 'customerName') { const s = value.length > 1 ? allClients.filter(c => c.name.toLowerCase().includes(value.toLowerCase())) : []; renderSuggestions(customerSuggestionsList, s, handleCustomerSuggestionClick, 'name'); } }
        function handleCustomerSuggestionClick(client) { customerNameInput.value = client.name; const f = formatPhoneNumber(client.phoneNumber); phoneNumberInput.value = f; customerSuggestionsList.classList.add('hidden'); phoneNumberError.classList.add('hidden'); }

        dropOffForm.addEventListener('input', handleInputChange);
        dropOffTypeSelect.addEventListener('change', updateConditionalFields);
        vehicleMakeSelect.addEventListener('change', (e) => populateModels(e.target.value));
        customerNameInput.addEventListener('blur', () => setTimeout(() => customerSuggestionsList.classList.add('hidden'), 150));
        document.querySelectorAll('.quantity-spinner').forEach(s => { createSpinner(s); s.addEventListener('click', handleSpinnerClick); });

        dropOffForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(dropOffForm);
            const data = Object.fromEntries(formData.entries());
            document.querySelectorAll('.quantity-spinner').forEach(s => { const id = s.id, key = id.replace('Spinner', 'Count'); data[key] = s.dataset.value; });
            try {
                const r = await fetch(`${API_BASE_URL}/api/submit`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
                if (!r.ok) throw new Error('Network response was not ok');
                showNotification('Form submitted successfully!');
                dropOffForm.reset();
                updateConditionalFields();
                populateModels('');
                document.querySelectorAll('.quantity-spinner').forEach(s => { s.dataset.value = 0; createSpinner(s); });
                fetchClients();
            } catch (err) { console.error('Error submitting form:', err); showNotification('Error submitting form. Please try again.', true); }
        });

        updateConditionalFields();
        fetchClients();
        populateYears();
        populateMakes();
        populateModels('');
    });
    </script>
</body>
</html>
